class Configurator {
  #validateSchema = (schema) => {
    const validator = new (require('jsonschema').Validator)();
    try {
      validator.checkSchema(schema);
    } catch (e) {
      throw new Error('Invalid configuration schema:', e);
    }
  };

  #validateDefaultConfig(defaultConfig, schema) {
    try {
      const validator = new (require('jsonschema').Validator)();
      validator.validate(defaultConfig, schema);
    } catch (e) {
      throw new Error('Invalid default configuration:', e);
    }
  }

  #validateStaticConfig(staticConfig, schema) {
    try {
      const validator = new (require('jsonschema').Validator)();
      validator.validate(staticConfig, schema);
    } catch (e) {
      throw new Error('Invalid static configuration:', e);
    }
  }

  constructor() {
    this.#config = {
      staticConfig: {
        VERSION: "1.0.0",
        env: process.env.NODE_ENV || "development"
      },
      defaultConfig: {
        foo: 'bar',
        baz: true
      },
      configSchema: {
        type: 'object',
        properties: {
          foo: { type: 'string' },
          baz: { type: 'boolean' }
        }
      }
    };
  }

  get configSchema() {
    return this.#config.configSchema;
  }

  defaultConfig() {
    return this.#config.defaultConfig;
  }

  staticConfig() {
    return this.#config.staticConfig;
  }

  #validate() {
    const schema = this.configSchema;
    try {
      this.#validateSchema(schema);
      this.#validateDefaultConfig(this.defaultConfig(), schema);
      this.#validateStaticConfig(this.staticConfig(), schema);
    } catch (e) {
      throw e;
    }
  }

  update(values = {}) {
    if (values.configSchema) {
      this.configSchema = values.configSchema;
    }
    this.#config.defaultConfig = {
      ...this.defaultConfig(),
      ...values.defaultConfig
    };
    this.#config.staticConfig = {
      ...this.staticConfig(),
      ...values.staticConfig
    };
    this.#validate();
  }
}

class LifecycleEvent {
  constructor(event) {
    this.#event = event;
  }

  get event() {
    return this.#event;
  }
}

class LifecycleHandler {
  constructor(handler) {
    this.#handler = handler;
  }

  bind(target = this) {
    this.#handler = this.#handler.bind(target);
  }

  async execute() {
    await this.#handler();
  }
}

class NexusCore {
  #status = "INIT";
  #lifecycle = {
    configured: false,
    loaded: false,
    shuttingDown: false
  };
  #configurator = new Configurator();
  onLifecycleEvents = {};

  get status() {
    return this.#status;
  }

  get lifecycle() {
    return this.#lifecycle;
  }

  get configurator() {
    return this.#configurator;
  }

  configure() {
    this.#configurator.#validate();
    this.#status = "CONFIGURED";
  }

  async load() {
    try {
      console.log("Loading...");
      await new Promise(resolve => setTimeout(resolve, 1000));
      console.log("Loading complete...");
      this.#lifecycle.loaded = true;
      this.#status = 'LOADED';
    } catch (e) {
      console.error('Load error:', e);
    }
  }

  async shutdown() {
    try {
      if (!this.#lifecycle.shuttingDown) {
        console.log("Shutdown initiated...");
        this.#lifecycle.shuttingDown = true;
        this.#status = "SHUTTING_DOWN";
        await new Promise(resolve => setTimeout(resolve, 1000));
        console.log("Shutdown complete...");
        this.#status = "SHUTDOWN";
      }
    } catch (e) {
      console.error("Shutdown error:", e);
    }
  }

  async start() {
    const startMethodOrder = ["configure", "load", "shutdown"];
    for (const methodName of startMethodOrder) {
      if (this[methodName] instanceof Function) {
        await this[methodName]();
      }
    }
  }

  async destroy() {
    this.#status = "DESTROYED";
    this.#lifecycle = {
      configured: false,
      loaded: false,
      shuttingDown: false
    };
  }

  on(event, handler) {
    if (typeof handler !== 'function') {
      throw new TypeError('Handler must be a function');
    }
    if (!this.#lifecycle[event]) {
      throw new Error(`Lifecycle event '${event}' is not available.`);
    }
    const lifecycleHandler = new LifecycleHandler(async () => handler());
    this.#lifecycle[event] = lifecycleHandler;
  }

  off(event) {
    delete this.#lifecycle[event];
  }

  async onLifecycleEvent(event) {
    try {
      if (!this.#lifecycle[event]) {
        throw new Error(`Lifecycle event '${event}' is not available.`);
      }
      await this.#lifecycle[event].bind(this).execute();
    } catch (error) {
      console.error('Error occurred during lifecycle event handling:', error);
    }
  }

  updateConfig(values = {}) {
    const mergedValues = {
      configSchema: values.configSchema ? values.configSchema : this.configurator.configSchema,
      defaultConfig: values.defaultConfig ? values.defaultConfig : this.configurator.defaultConfig(),
      staticConfig: values.staticConfig ? values.staticConfig : this.configurator.staticConfig()
    };
    this.configurator.update(mergedValues);
  }
}

const nexusCore = new NexusCore();

nexusCore.on('DESTROYED', async () => {
  console.log("NexusCore instance destroyed.");
});

nexusCore.configurator.updateConfig({
  staticConfig: {
    env: 'production'
  },
  defaultConfig: {
    baz: false
  }
});

nexusCore.configure();
await nexusCore.start();
await nexusCore.load();
await nexusCore.shutdown();
await nexusCore.destroy();