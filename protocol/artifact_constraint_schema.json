{
  "$schema": "http://json-schema.org/draft/2020-12/schema#",
  "$id": "http://dse-protocol/artifact_constraint_schema.json",
  "title": "DSE Artifact Constraint Definition Schema",
  "description": "Defines the structure for entries within the Artifact Constraint Verification Database (ACVD). These constraints govern verification checks applied during the GSEP lifecycle.",
  "type": "object",
  "$defs": {
    "ConstraintID": {
      "type": "string",
      "format": "uuid",
      "description": "Unique identifier for this specific verification constraint definition."
    },
    "VerificationScope": {
      "type": "string",
      "enum": [
        "STRUCTURE",
        "METADATA",
        "PAYLOAD",
        "CROSS_ARTIFACT"
      ],
      "description": "Specifies which part or type of artifact content the constraint applies to."
    },
    "VerificationType": {
      "type": "string",
      "enum": [
        "IntegrityCheck",
        "FormatCompliance",
        "RangeValidation",
        "SchemaCompliance",
        "RelationshipCheck"
      ],
      "description": "Classification of the constraint logic mechanism."
    },
    "LogicParameters": {
      "type": "object",
      "description": "Key-value pairs required as input parameters for the specific constraint logic function identified by constraint_logic_hash. (e.g., { 'min_length': 10, 'regex_pattern': '^DSE-.*' })",
      "additionalProperties": true
    }
  },
  "properties": {
    "constraint_id": {
      "$ref": "#/$defs/ConstraintID"
    },
    "artifact_type": {
      "$ref": "./artifact_manifest_schema.json#/$defs/ArtifactID"
    },
    "target_gsep_stages": {
      "type": "array",
      "minItems": 1,
      "uniqueItems": true,
      "items": {
        "$ref": "./artifact_manifest_schema.json#/$defs/GSEPStage"
      },
      "description": "List of GSEP stages where this constraint is actively checked."
    },
    "verification_scope": {
      "$ref": "#/$defs/VerificationScope"
    },
    "verification_type": {
      "$ref": "#/$defs/VerificationType"
    },
    "verification_target_path": {
      "type": "string",
      "description": "A JSONPath or equivalent selector pointing to the specific field or structure within the artifact being validated (e.g., '$.metadata.checksum'). Optional if scope is STRUCTURE."
    },
    "constraint_logic_hash": {
      "$ref": "./artifact_manifest_schema.json#/$defs/SHA256Hash",
      "description": "Hash of the deterministic implementation code (logic function) executed for this constraint."
    },
    "logic_parameters": {
      "$ref": "#/$defs/LogicParameters",
      "default": {},
      "description": "Input parameters needed by the constraint_logic_hash function. These parameters are intrinsic to the constraint definition."
    }
  },
  "required": [
    "constraint_id",
    "artifact_type",
    "target_gsep_stages",
    "verification_scope",
    "verification_type",
    "constraint_logic_hash"
  ],
  "dependencies": {
    "verification_target_path": {
      "not": {
        "properties": {
          "verification_scope": {
            "const": "STRUCTURE"
          }
        }
      }
    }
  }
}