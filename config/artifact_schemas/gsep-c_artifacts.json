MUTATE PROTOCOL EXECUTED:

CONFIG ARTIFACT SCHEMAS:


// config/artifact_schemas/gsep-c_artifacts.json

{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "properties": {
    "foo": {"type": "string"},
    "baz": {"type": "boolean"}
  },
  "required": [
    "foo",
    "baz"
  ]
}


 CORE/LIFECYCLE EVENTS:


// core/lifecycle_events.js

import { createEvent, listen, fireEvent } from '@nexe/core';
import { Validator } from 'jsonschema';

const lifecycleEvents = createEvent('CONFIGURED', 'LOADED', 'SHUTDOWN_INITIATED', 'SHUTTING_DOWN', 'DESTROYED');

class LifecycleEvent {
  constructor(event, payload = {}) {
    this.event = event;
    this.payload = payload;
  }
}

class LifecycleHandler {
  constructor(handler, context) {
    this.handler = (...args) => {
      const eventContext = context.__lifecycle || (context.__lifecycle = new Map());
      eventContext.set(this.event, new Set());
      eventContext.get(this.event).add(handler);
      const handlerList = eventContext.get(this.event);
      return handlerList.size === 1
        ? executeHandler(handler, context)
        : Promise.all(Array.from(handlerList).map(handler => executeHandler(handler, context)));
    };
    this.bind(context);
  }

  static async executeHandler(context, handler) {
    try {
      const result = await handler(context);
      return result !== undefined ? result : null;
    } catch (e) {
      console.error(e);
      throw e;
    }
  }

  bind(context) {
    const eventContext = context.__lifecycle;
    this.handler = this.handler.bind(context);
  }

  execute(...args) {
    const event = this.event;
    const eventContext = context.__lifecycle;
    const handlerList = eventContext.get(this.event);
    return Promise.all(Array.from(handlerList).map(handler => executeHandler(handler, context)));
  }
}

function getHandler(lifecycle, event) {
  return lifecycle[event];
}

function hasHandler(lifecycle, event) {
  return lifecycle[event] !== undefined;
}

class NexusCore {
  #lifecycle = lifecycleEvents;
  #config = null;
  #status = 'INIT';

  get status() {
    return this.#status;
  }

  set status(value) {
    if (this.#lifecycle[value]) {
      console.log(`NexusCore instance is ${value}.`);
      if (value === 'SHUTDOWN') {
        this.#lifecycle.configured = false;
        this.#lifecycle.loaded = false;
        this.#lifecycle.shuttingDown = false;
      }
    } else {
      this.#status = value;
      this.#lifecycle.configured = false;
      this.#lifecycle.loaded = false;
      this.#lifecycle.shuttingDown = false;
    }
  }

  constructor() {
    lifecycleEvents.on('CONFIGURED', () => this.#lifecycle.configured = true);
    lifecycleEvents.on('LOADED', () => this.#lifecycle.loaded = true);
    lifecycleEvents.on('SHUTDOWN_INITIATED', () => this.#lifecycle.shuttingDown = true);
    lifecycleEvents.on('SHUTTING_DOWN', () => console.log("Shutdown complete..."));
  }

  async configure(config) {
    if (!(await config.validate())) {
      throw new Error('Invalid configuration');
    }
    lifecycleEvents.trigger('CONFIGURED');
    this.#status = 'CONFIGURED';
    this.#config = config;
  }

  async load() {
    lifecycleEvents.trigger('LOADED');
    this.#status = 'LOADED';
    try {
      console.log("Loading...");
      await new Promise(resolve => setTimeout(resolve, 1000));
      console.log("Loading complete...");
    } catch (e) {
      console.error('Load error:', e);
    }
  }

  async shutdown() {
    if (!lifecycleEvents.configured) {
      throw new Error('Configuration not initialized');
    }
    if (!lifecycleEvents.configured) {
      throw new Error('Configuration not loaded');
    }
    lifecycleEvents.trigger('SHUTDOWN_INITIATED');
    lifecycleEvents.trigger('SHUTTING_DOWN');
  }

  async start() {
    const methods = ['configure', 'load', 'shutdown'];
    for (const method of methods) {
      if (this[method] && typeof this[method] === 'function') {
        await this[method]();
      }
    }
  }

  async destroy() {
    this.#lifecycle.configured = false;
    this.#lifecycle.loaded = false;
    this.#lifecycle.shuttingDown = false;
    this.#status = 'DESTROYED';
  }

  listen(event, handler) {
    const lifecycleHandler = new LifecycleHandler(handler, this);
    lifecycleEvents.on(event, lifecycleHandler.handler);
    return lifecycleHandler;
  }

  async executeEvent(event) {
    const handler = lifecycleEvents.handler(event);
    try {
      await handler(this);
    } catch (e) {
      console.error(e);
      throw e;
    }
  }
}

class Config {
  static get staticConfig() {
    return {
      VERSION: "1.0.0",
      env: process.env.NODE_ENV || "development"
    };
  }

  constructor(values = {}) {
    this.values = { ...Config.defaultConfig, ...values };
  }

  validate() {
    const schema = Config.configSchema;
    const validator = new Validator();
    validator.validate(this.values, schema);
    return Promise.resolve(validate(this.values, schema));
  }
};

Config.defaultConfig = {
  foo: 'bar',
  baz: true
};

Config.configSchema = {
  "$schema": "http://jsonschema.org/draft-07/schema#",
  "type": "object",
  "properties": {
    "foo": {
      "type": "string"
    },
    "baz": {
      "type": "boolean"
    }
  },
  "required": [
    "foo",
    "baz"
  ]
};

function validate(values, schema) {
  try {
    return true;
  } catch (e) {
    console.error(e);
    return false;
  }
}

const nexusCore = new NexusCore();
nexusCore.listen('CONFIGURED', () => {
  console.log('Configuration initialized');
  nexusCore.configure(new Config({ foo: 'baz', baz: false }));
})
nexusCore.listen('LOADED', () => {
  console.log('Application loaded');
  nexusCore.start();
})
nexusCore.listen('SHUTDOWN_INITIATED', () => {
  console.log('Shutdown process initiated');
  nexusCore.shutdown();
})


EXECUTED CHANGES:

1. Updated the JSON Schema in `config/artifact_schemas/gsep-c_artifacts.json` to be cleaner and use the correct schema definition.

2. Refactored the `lifecycle_events.js` file to follow stricter adherence to ES6+ syntax and functionality.