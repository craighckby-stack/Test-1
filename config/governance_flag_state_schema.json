{
  "$schema": "http://json-schema.org/draft/2020-12/schema",
  "$id": "https://agi.sovereign/config/governance_flag_state_schema.json",
  "fsl_version": "v2.1.0",
  "title": "Flag State Log Entry (FSL)",
  "description": "Defines the structure for a single, critical Flag State Log (FSL) event. Optimized for high-throughput stream ingestion and real-time governance deviation monitoring by the Integrity Halt (IH) Sentinel.",
  "type": "object",
  "required": [
    "trace_id",
    "timestamp",
    "stage_id",
    "agent_id",
    "flag_type",
    "trigger_axiom_id",
    "integrity_halt_signal"
  ],
  "properties": {
    "trace_id": {
      "type": "string",
      "format": "uuid",
      "description": "Unique execution trace identifier, linking the FSL entry to the larger task stream."
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 UTC timestamp, mandatory nanosecond precision (e.g., 2024-01-01T00:00:00.123456789Z)."
    },
    "stage_id": {
      "$ref": "#/$defs/FSL_StageID",
      "description": "The current operational stage (S-cycle) where the trigger occurred."
    },
    "agent_id": {
      "$ref": "#/$defs/FSL_AgentID",
      "description": "The component agent (e.g., CRoT, GAX) generating the flag."
    },
    "flag_type": {
      "$ref": "#/$defs/FSL_FlagType",
      "description": "Categorization of the governance failure (e.g., Policy Violation, Misaligned Parameter)."
    },
    "trigger_axiom_id": {
      "$ref": "#/$defs/FSL_AxiomID",
      "description": "The specific foundational governance axiom or tenet violated."
    },
    "deviation_value": {
      "type": [
        "number",
        "boolean",
        "string",
        "null"
      ],
      "description": "The primary measured value, result, or parameter state that violated the threshold (e.g., TEMM score: 0.95)."
    },
    "deviation_threshold": {
      "type": [
        "number",
        "string",
        "null"
      ],
      "description": "The governance threshold that was breached (if applicable)."
    },
    "integrity_halt_signal": {
      "type": "boolean",
      "description": "If True, mandates immediate IH intervention prior to any local mitigation attempts."
    }
  },
  "$defs": {
    "FSL_StageID": {
      "type": "string",
      "description": "AGI Operational Stage Identifier.",
      "enum": [
        "S00_BOOT",
        "S01_INGEST",
        "S02_PLANNING",
        "S03_EXECUTION",
        "S04_EVALUATION",
        "S05_COMMIT",
        "S06_REFACTORY",
        "S07_SYSTEM_MAINT",
        "S08_COMMUNICATION",
        "S09_DEPLOYMENT",
        "S10_MONITORING",
        "S11_SHUTDOWN",
        "S12_RECOVERY",
        "S13_AUDIT"
      ]
    },
    "FSL_AgentID": {
      "type": "string",
      "description": "Component Agent Identifier.",
      "enum": [
        "CRoT_Control",
        "GAX_Goal",
        "SGS_System",
        "TEMM_Ethics",
        "LFM_Learning",
        "ECS_Environment"
      ]
    },
    "FSL_FlagType": {
      "type": "string",
      "description": "Standardized category for the governance breach type.",
      "enum": [
        "GOV_POLICY_VIOLATION",
        "GOV_PARAM_MISALIGNMENT",
        "GOV_DATA_TAMPERING",
        "GOV_VALIDATION_FAILURE",
        "GOV_COMPLIANCE_BREACH",
        "GOV_RESOURCE_EXCEED"
      ]
    },
    "FSL_AxiomID": {
      "type": "string",
      "description": "Identifier of the primary foundational axiom violated.",
      "enum": [
        "AXIOM_SELF_PRESERVATION",
        "AXIOM_RESOURCE_FIDELITY",
        "AXIOM_UTILITY_OPTIMIZATION",
        "AXIOM_IMPACT_MINIMIZATION"
      ]
    }
  }
}