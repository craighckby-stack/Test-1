{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://agi.sovereign/schemas/v94/ArtifactStructuralDefinition.json",
  "title": "ArtifactStructuralDefinition",
  "description": "Defines the required structure, metadata, dependencies, and processing instructions for an output artifact managed by the AGI system, ensuring full traceability and reliable generation.",
  "type": "object",
  "properties": {
    "artifactName": {
      "type": "string",
      "description": "A descriptive, human-readable name for the artifact (e.g., 'UserServiceController')."
    },
    "artifactId": {
      "type": "string",
      "format": "uuid",
      "description": "The unique, immutable identifier for this specific artifact definition."
    },
    "type": {
      "type": "string",
      "enum": [
        "Component",
        "Library",
        "Configuration",
        "TestFixture",
        "Documentation",
        "DataModel",
        "Pipeline"
      ],
      "description": "The fundamental category or architectural role of the artifact."
    },
    "version": {
      "type": "string",
      "format": "semver",
      "description": "Semantic versioning (X.Y.Z) of the artifact definition itself."
    },
    "metadata": {
      "type": "object",
      "description": "General metadata for identification and classification.",
      "properties": {
        "description": {
          "type": "string"
        },
        "ownerModule": {
          "type": "string",
          "description": "The AGI core module responsible for managing this definition (e.g., 'EvolutionEngine', 'ScaffoldingUnit')."
        },
        "tags": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "language": {
          "type": "string",
          "description": "Primary programming or configuration language (e.g., 'TypeScript', 'YAML')."
        }
      }
    },
    "dependencies": {
      "type": "array",
      "description": "List of required structural or code dependencies needed for consumption or compilation.",
      "items": {
        "$ref": "#/$defs/DependencySpec"
      }
    },
    "structure": {
      "type": "array",
      "description": "Defines the mandatory files and directory hierarchy required by this artifact.",
      "items": {
        "$ref": "#/$defs/StructureNode"
      }
    },
    "pipeline": {
      "type": "object",
      "description": "Instructions for generation, validation, compilation, and integration.",
      "properties": {
        "generatorReference": {
          "type": "string",
          "description": "Reference path or ID to the primary generator module (e.g., 'engines/react/ComponentGenerator')."
        },
        "validationSchemaRef": {
          "type": "string",
          "description": "Optional reference to an external schema used to validate the final content of the artifact (e.g., for JSON/YAML files)."
        },
        "hooks": {
          "type": "object",
          "properties": {
            "preGenScript": {
              "type": "string",
              "description": "Reference to a specialized script or function executed just before generation starts."
            },
            "postBuildCommand": {
              "type": "string",
              "description": "CLI command executed after successful artifact creation/building."
            }
          }
        }
      },
      "required": [
        "generatorReference"
      ]
    }
  },
  "required": [
    "artifactId",
    "type",
    "structure",
    "version",
    "pipeline"
  ],
  "$defs": {
    "DependencySpec": {
      "type": "object",
      "description": "Specifies a required external or internal artifact dependency.",
      "properties": {
        "dependencyId": {
          "type": "string",
          "format": "uuid",
          "description": "The UUID of the required artifact definition."
        },
        "requiredVersionRange": {
          "type": "string",
          "description": "NPM-style semantic version range compatible with the dependency (e.g., ^1.2.0, ~2.0.x)."
        },
        "usage": {
          "type": "string",
          "enum": [
            "InternalImport",
            "ExternalPackage",
            "ConfigurationSource",
            "RuntimeResource"
          ],
          "description": "How the dependency is utilized by this artifact."
        }
      },
      "required": [
        "dependencyId",
        "requiredVersionRange",
        "usage"
      ]
    },
    "StructureNode": {
      "type": "object",
      "description": "A recursive definition for files and directories within the artifact.",
      "properties": {
        "name": {
          "type": "string",
          "description": "File or directory name (must be unique within parent directory)."
        },
        "isDir": {
          "type": "boolean",
          "default": false,
          "description": "If true, this node is a directory; otherwise, it is a file."
        },
        "required": {
          "type": "boolean",
          "default": true,
          "description": "If false, the file/directory is optional."
        },
        "templatePath": {
          "type": "string",
          "description": "Optional path to the source template file (e.g., EJS, Handlebars). Only valid if isDir is false."
        },
        "contentTemplate": {
          "type": "string",
          "description": "Optional inline template string used if templatePath is omitted."
        },
        "children": {
          "type": "array",
          "description": "Only valid if isDir is true.",
          "items": {
            "$ref": "#/$defs/StructureNode"
          }
        }
      },
      "required": [
        "name"
      ],
      "if": {
        "properties": {
          "isDir": {
            "const": true
          }
        }
      },
      "then": {
        "required": [
          "children"
        ],
        "properties": {
          "templatePath": {
            "not": {}
          },
          "contentTemplate": {
            "not": {}
          }
        }
      },
      "else": {
        "required": [],
        "properties": {
          "children": {
            "not": {}
          }
        }
      }
    }
  }
}