{
  "$schema": "http://json-schema.org/draft/2020-12/schema",
  "$id": "https://agi.sovereign/config/remediation_playbook_catalog_schema.json",
  "title": "Remediation Playbook Catalog Schema (v94.1)",
  "description": "Defines the available remediation playbooks executable by the Integrity Halt Sentinel (IHS), including necessary execution constraints, required parameters, and defined safety levels.",
  "type": "object",
  "required": ["playbooks", "catalog_version"],
  "properties": {
    "catalog_version": {
      "type": "string",
      "format": "semver",
      "description": "Semantic versioning of the playbook catalog file structure itself."
    },
    "playbooks": {
      "type": "object",
      "description": "Map of globally unique Playbook Identifiers (PXXX_NAME) to execution definitions.",
      "patternProperties": {
        "^P[0-9]{3}_[A-Z0-9_]+$": {
          "$ref": "#/$defs/PlaybookDefinition"
        }
      },
      "additionalProperties": false,
      "minProperties": 1
    }
  },
  "additionalProperties": false,
  "$defs": {
    "SafetyLevel": {
      "type": "string",
      "enum": [
        "L0_AUDIT",
        "L1_SAFE_ROLLBACK",
        "L2_MUTATING",
        "L3_DESTRUCTIVE",
        "L4_CORE_IMMUTABLE"
      ],
      "description": "Safety rating. L0: Non-mutating audit. L1: Safe, easily reversible. L2: Mutating operations. L3: Destructive/Irreversible. L4: Critical core system actions."
    },
    "PlaybookDefinition": {
      "type": "object",
      "required": [
        "name",
        "executor",
        "safety_level",
        "parameters_schema"
      ],
      "properties": {
        "name": {
          "type": "string",
          "description": "Human-readable descriptive name of the playbook."
        },
        "description": {
          "type": "string",
          "description": "Detailed explanation of the playbook's function, risks, and execution context."
        },
        "executor": {
          "type": "string",
          "description": "Identifier (e.g., Docker image tag, module path) for the executable remediation component."
        },
        "safety_level": {
          "$ref": "#/$defs/SafetyLevel"
        },
        "requires_confirmation": {
          "type": "boolean",
          "default": false,
          "description": "If true, requires operator confirmation regardless of severity or system context."
        },
        "timeout_seconds": {
          "type": "integer",
          "minimum": 5,
          "default": 300,
          "description": "Maximum allowed execution time before the playbook is forcefully halted."
        },
        "parameters_schema": {
          "type": "object",
          "description": "The full JSON Schema defining the runtime input parameters required by the executor.",
          "required": [
            "type",
            "properties"
          ]
        }
      },
      "additionalProperties": false
    }
  }
}