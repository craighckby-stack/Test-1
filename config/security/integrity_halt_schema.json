{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "http://sovereignagi.com/ih_log_v3.0.json",
  "title": "Sovereign AGI Integrity Halt Log (High Assurance)",
  "description": "Schema for logging catastrophic integrity failure events, complying with TVCR and CRoT mandates. Version 3.0.",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "Schema_Version",
    "IH_Timestamp",
    "IH_Identifier",
    "GSEP_C_Stage",
    "Halt_Code",
    "Halt_Category",
    "Halt_Reason_Detail",
    "Halt_Context",
    "State_Vector_Hash",
    "Log_Integrity_Checksum",
    "CSK_Verification_Signature"
  ],
  "$defs": {
    "Hash512": {
      "type": "string",
      "description": "Standard 512-bit hexadecimal hash.",
      "pattern": "^[0-9a-fA-F]{128}$",
      "minLength": 128,
      "maxLength": 128
    },
    "Hash256": {
      "type": "string",
      "description": "Standard 256-bit hexadecimal hash.",
      "pattern": "^[0-9a-fA-F]{64}$",
      "minLength": 64,
      "maxLength": 64
    },
    "Halt_Categories": {
      "type": "string",
      "enum": [
        "CRITICAL_CONTROL_FLOW_VIOLATION",
        "SECURITY_KEY_MATERIAL_FAILURE",
        "STATE_DESYNCHRONIZATION",
        "TRUST_ROOT_MALFUNCTION",
        "UNAUTHORIZED_RESOURCE_ACCESS"
      ]
    }
  },
  "properties": {
    "Schema_Version": {
      "type": "string",
      "description": "Internal version tag for the log structure.",
      "const": "v3.0"
    },
    "IH_Timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "Time of detected Integrity Halt (UTC, ISO 8601 strict)."
    },
    "IH_Identifier": {
      "type": "string",
      "format": "uuid",
      "description": "Unique UUID assigned to this specific Halt event instance."
    },
    "GSEP_C_Stage": {
      "type": "string",
      "enum": [
        "S0_PRE_INIT",
        "S10_CORE_LOAD",
        "S_RUNTIME_L1",
        "S_RUNTIME_L2",
        "S_SHUTDOWN",
        "S_POST_MORTEM"
      ],
      "description": "The GSEP-C stage during which the halt was triggered."
    },
    "Halt_Code": {
      "type": "string",
      "pattern": "^IH-[0-9]{3}$",
      "description": "Standardized alpha-numeric error code (e.g., IH-101)."
    },
    "Halt_Category": {
      "$ref": "#/$defs/Halt_Categories",
      "description": "High-level categorization for automated failure analysis."
    },
    "Halt_Reason_Detail": {
      "type": "string",
      "description": "Detailed summary of the failure (replaces old Halt_Reason)."
    },
    "Halt_Context": {
      "type": "object",
      "required": [
        "CRoT_ID",
        "Checklist_Ref",
        "Failed_Module_ID"
      ],
      "description": "Contextual information relating the halt to the trust mandate.",
      "additionalProperties": false,
      "properties": {
        "CRoT_ID": {
          "type": "string",
          "description": "Unique identifier for the CRoT instance that enforced the halt."
        },
        "Checklist_Ref": {
          "type": "string",
          "pattern": "^[0-9]{1,2}\.[0-9]{1,2}(\.[0-9]{1,2})?$",
          "description": "Reference ID from the CRoT Enforcement Manifest (e.g., 2.1, 4.1.1)."
        },
        "Failed_Module_ID": {
          "type": "string",
          "description": "The canonical ID of the module or service that triggered the violation."
        }
      }
    },
    "State_Vector_Hash": {
      "$ref": "#/$defs/Hash512",
      "description": "SHA-512 hash of the failed system state vector, recorded prior to shutdown."
    },
    "Log_Integrity_Checksum": {
      "$ref": "#/$defs/Hash256",
      "description": "SHA-256 hash of the log payload (excluding the CSK Signature). Used for high-speed transmission integrity checks."
    },
    "CSK_Verification_Signature": {
      "type": "string",
      "description": "Cryptographic signature of the entire log entry (including the Integrity Checksum) generated by the PSM using the Core Security Key (CSK). Expected to be Base64Url encoded.",
      "format": "byte"
    }
  }
}