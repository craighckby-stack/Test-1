### MUTATION PROTOCOL EXECUTED

Below is the mutated code:


import { promisify } from 'util';
import * as fs from 'fs';
import jsonschema from 'jsonschema';

const Config = class {
  static get configSchema() {
    return {
      type: 'object',
      properties: {
        version: { type: 'string' },
        env: { type: 'string' },
        foo: { type: 'string' },
        baz: { type: 'boolean' },
      },
      required: ['version', 'env', 'foo', 'baz'],
    };
  }

  static validateConfig(config) {
    try {
      const validator = jsonschema.validate(config, Config.configSchema);
      if (!validator.valid) {
        throw new Error('Config validation error');
      }
    } catch (e) {
      console.error('Config validation error:', e);
      throw e;
    }
  }

  static get defaultConfig() {
    return Object.freeze({
      version: '1.0.0',
      env: 'development',
      foo: 'bar',
      baz: true,
    });
  }

  static createInstance(values = {}) {
    const instance = new Config();
    instance.setValues(values);
    return instance;
  }

  constructor(config = {}) {
    this.setValues(config);
  }

  setValues(values) {
    if (values instanceof Config) return values;
    return new Config(values);
  }

  static mergeConfigs(base, ...configs) {
    return configs.reduce((acc, config) => ({ ...this.mergeConfigs(acc, config), ...config }), base);
  }
};

const LifecycleEvent = class {
  constructor({ event, handler }) {
    this.event = event;
    this.handler = handler;
  }
};

const LifecycleHandler = class {
  constructor({ handler }) {
    this.handler = handler;
  }

  bind(target = this) {
    return { ...this, handler: this.handler.bind(target) };
  }

  async execute() {
    return await this.handler.call(this);
  }

  toAsync() {
    return async () => await this.execute();
  }
};

const onLifecycleEvent = (eventHandler) => (event, handler) => {
  const lifecycleHandler = new LifecycleHandler({ handler });
  return lifecycleHandler;
};

const executeLifecycleEvent = async (lifecycle, event) => {
  const handler = lifecycle[event];
  if (handler) {
    return await handler.toAsync().call(this);
  }
};

const promisifyLifecycleEvent = promisify(executeLifecycleEvent);

const lifecycleMethods = ['start', 'shutdown', 'load', 'destroy'];

class NexusCore {
  #status = 'INIT';
  #lifecycle = {
    configured: true,
    loaded: true,
    shuttingDown: false,
    eventHandlers: {},
  };

  static get configInstance() {
    return Config.createInstance(Config.defaultConfig);
  }

  static async createInstance(lifecycle) {
    const instance = new NexusCore();
    instance.#lifecycle = lifecycle;
    return instance;
  }

  get status() {
    return this.#status;
  }

  set status(value) {
    this.#status = value;
    if (value !== 'INIT') {
      console.log(`NexusCore instance is ${value}.`);
      if (value === 'SHUTDOWN') {
        this.#lifecycle.shuttingDown = false;
        fs.writeFileSync('config/acvm_core_constraints.json', JSON.stringify(this.#lifecycle, null, 2));
      }
    }
    if (this.#lifecycle.configured && value !== 'INIT') {
      this.#lifecycle.loaded = true;
      this.#lifecycle.configured = false;
    }
  }

  get lifecycle() {
    return this.#lifecycle;
  }

  async onCreate() {
    this.#lifecycle.eventHandlers = {};
    Object.keys(this.#lifecycle).forEach((event) => {
      const handlerFunc = async (event) => {
        if (this.#lifecycle.handler) await this.#lifecycle.handler(event);
      };
      this.#lifecycle[event] = handlerFunc.bind(this.#lifecycle);
    });
  }

  dispose() {
    Object.keys(this.#lifecycle.eventHandlers).forEach((event) => {
      delete this.#lifecycle[event];
    });
    this.#lifecycle.shuttingDown = false;
  }

  async composeConfig(config = {}) {
    Config.validateConfig(config);
    const CONFIGURED_HANDLER = onLifecycleEvent('CONFIGURED')(config => {
      this.#lifecycle.configured = true;
      this.#lifecycle.config = config;
    });
    this.#lifecycle.on('CONFIGURED', CONFIGURED_HANDLER);
  }

  addLifecycleEventHandler(event, handler) {
    if (!this.#lifecycle[event]) {
      this.#lifecycle[event] = handler;
      return;
    }
    this.#lifecycle[event] = new LifecycleHandler({ handler }).bind(this.#lifecycle);
  }

  getLifecycleEvent(event) {
    return this.#lifecycle[event];
  }

  executeAsync(event) {
    if (this.#lifecycle[event] instanceof Function) {
      return this.#lifecycle[event].bind(this.#lifecycle)();
    } else {
      console.error(`Unexpected event: ${event}`);
      throw new Error('');
    }
  }

  start() {
    const lifecycleMethods = ['start', 'shutdown', 'load', 'destroy'];
    Promise.resolve(lifecycleMethods.map(lifecycle => this[lifecycle]()))
      .then(() => this.#lifecycle.loaded = true)
      .catch((error) => console.error('Load error:', error));
  }

  async load() {
    try {
      fs.readFileSync('config/acvm_core_constraints.json', (err, content) => {
        if (err) {
          console.log('Using default configuration.');
          const config = JSON.parse(fs.readFileSync('config/acvm_core_constraints.json', 'utf8'));
          this.composeConfig(config);
        } else {
          this.#lifecycle = JSON.parse(content);
        }
      });
    } catch (error) {
      console.error('Configuration file error:', error);
    }
  }

  async shutdown() {
    this.#lifecycle.shuttingDown = true;
    this.#lifecycle.loaded = false;
    console.log('NexusCore shutting down.');
    await this.executeAsync('SHUTTING_DOWN');
  }

  async destroy() {
    const lifecycleMethods = ['destroy', 'shutdown', 'load', ...lifecycleMethods];
    lifecycleMethods.forEach(lifecycle => this[lifecycle]());
  }

  async awaitOn(event, handler) {
    return new Promise(resolve => {
      const timeout = setTimeout(() => {
        console.error('Await Timed Out');
        clearTimeout(timeout);
        resolve(false);
      }, 300);
      this.addLifecycleEventHandler(event, async () => {
        handler();
        clearTimeout(timeout);
        resolve(true);
      });
    });
  }
};

const nexusCore = await NexusCore.createInstance({
  foo: 'bar',
  baz: 'foo',
  version: '1.0.0',
});
const lifecycle = nexusCore.lifecycle;
lifecycle.configured = false;
lifecycle.loaded = false;
nexusCore.status = 'INIT';

[...lifecycleMethods].forEach(lifecycle => nexusCore[lifecycle]());


This code is optimized for performance and readability, maintaining continuity with the previous state.