{
  "$schema": "http://json-schema.org/draft-04/schema#",
  "$id": "http://sovereign.ai/schemas/TEDS_Schema.json",
  "title": "TEDS_V1_0_0",
  "description": "Technical Evidence Data Set (TEDS) Schema for RRP (Rollback Protocol) forensic capture.",
  "type": "object",
  "required": [
    "metadata",
    "components",
    "attestation"
  ],
  "properties": {
    "metadata": {
      "type": "object",
      "description": "Mandatory descriptive data about the capture event.",
      "required": ["TEDS_Version", "capture_timestamp", "failure_stage", "protocol_failure_code"],
      "properties": {
        "TEDS_Version": {
          "type": "string",
          "pattern": "^1\.0\.0$",
          "description": "Schema version used."
        },
        "capture_timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp of TEDS initiation."
        },
        "failure_stage": {
          "type": "string",
          "pattern": "^S(0[2-9]|1[0-1])$",
          "description": "The specific RRP stage (S02 through S11) that triggered the capture."
        },
        "protocol_failure_code": {
          "type": "string",
          "description": "Specific GAX violation or RRP trigger identifier."
        }
      }
    },
    "components": {
      "type": "object",
      "description": "Captured system snapshots and evidence artifacts.",
      "required": ["Current_ASM_Snapshot", "Active_Configuration_Roots", "Execution_Environment_Context"],
      "properties": {
        "Current_ASM_Snapshot": {
          "type": "object",
          "description": "Snapshot of the Active System Memory (ASM).",
          "required": ["artifact_id", "TEMM", "ECVM", "PVLM", "MPAM", "ADTM"],
          "properties": {
            "artifact_id": {"type": "string", "enum": ["ASM"]},
            "TEMM": {"type": "string", "description": "Trusted Execution Manager Model state hash.", "minLength": 64},
            "ECVM": {"type": "string", "description": "Execution Control Vector Map hash.", "minLength": 64},
            "PVLM": {"type": "string", "description": "Physical Virtual Link Map hash.", "minLength": 64},
            "MPAM": {"type": "string", "description": "Micro-Program Access Map hash.", "minLength": 64},
            "ADTM": {"type": "string", "description": "Autonomous Drift Tolerance Model hash.", "minLength": 64}
          }
        },
        "Active_Configuration_Roots": {
          "type": "object",
          "description": "Bundle of critical immutable configuration hashes.",
          "required": ["artifact_id", "CSR_Hash", "ACVD_Hash", "FASV_Hash", "EPB_Hash"],
          "properties": {
            "artifact_id": {"type": "string", "enum": ["CR_Bundle"]},
            "CSR_Hash": {"type": "string", "description": "Configuration Set Root Hash.", "minLength": 64},
            "ACVD_Hash": {"type": "string", "description": "Active Core Version Delta Hash.", "minLength": 64},
            "FASV_Hash": {"type": "string", "description": "Forensic Archive Security Vector Hash.", "minLength": 64},
            "EPB_Hash": {"type": "string", "description": "Execution Policy Bundle Hash.", "minLength": 64}
          }
        },
        "Execution_Environment_Context": {
          "type": "object",
          "description": "Runtime metrics and log snippets leading to failure.",
          "required": ["artifact_id", "ResourceUtilizationMetrics", "ExecutionLogSlice"],
          "properties": {
            "artifact_id": {"type": "string", "enum": ["EEC"]},
            "ResourceUtilizationMetrics": {"type": "object", "description": "Time series metrics of compute/memory/IO usage."},
            "ExecutionLogSlice": {"type": "string", "description": "Base64 encoded or plaintext log excerpt.", "minLength": 10}
          }
        }
      }
    },
    "attestation": {
      "type": "object",
      "description": "Cryptographic proof of TEDS integrity and capture authority.",
      "required": ["signing_agent", "signature_payload"],
      "properties": {
        "signing_agent": {
          "type": "string",
          "enum": ["CRoT"],
          "description": "The designated signing authority (CRoT - Core Root of Trust)."
        },
        "signing_mandate": {
          "type": "string",
          "description": "Mandate summary."
        },
        "signature_payload": {
          "type": "string",
          "description": "Cryptographic signature of the canonicalized TEDS artifact (e.g., Base64 encoded ECDSA signature).",
          "minLength": 128
        }
      }
    }
  }
}