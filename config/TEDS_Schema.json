{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "http://sovereign.ai/schemas/TEDS_Schema.json",
  "title": "TEDS_V1_0_0",
  "description": "Technical Evidence Data Set (TEDS) Schema for RRP (Rollback Protocol) forensic capture. Refactored to use Draft 7 and modular definitions ($defs).",
  "type": "object",
  "required": [
    "metadata",
    "components",
    "attestation"
  ],
  "$defs": {
    "CryptographicHash": {
      "type": "string",
      "description": "A high-entropy cryptographic hash (e.g., SHA-256), enforced to be a 64-character hexadecimal string.",
      "minLength": 64,
      "maxLength": 64,
      "pattern": "^[0-9a-fA-F]{64}$"
    },
    "SignaturePayload": {
      "type": "string",
      "description": "Cryptographic signature of the canonicalized TEDS artifact (e.g., Base64 encoded ECDSA signature).",
      "minLength": 128
    },
    "ArtifactIdentifier": {
      "type": "string",
      "description": "A unique, constant identifier for the TEDS component artifact."
    }
  },
  "properties": {
    "metadata": {
      "type": "object",
      "description": "Mandatory descriptive data about the capture event.",
      "required": ["TEDS_Version", "capture_timestamp", "failure_stage", "protocol_failure_code"],
      "properties": {
        "TEDS_Version": {
          "type": "string",
          "const": "1.0.0",
          "description": "Schema version used (must be 1.0.0)."
        },
        "capture_timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp of TEDS initiation."
        },
        "failure_stage": {
          "type": "string",
          "pattern": "^S(0[2-9]|1[0-1])$",
          "description": "The specific RRP stage (S02 through S11) that triggered the capture."
        },
        "protocol_failure_code": {
          "type": "string",
          "description": "Specific GAX violation or RRP trigger identifier."
        }
      }
    },
    "components": {
      "type": "object",
      "description": "Captured system snapshots and evidence artifacts.",
      "required": ["Current_ASM_Snapshot", "Active_Configuration_Roots", "Execution_Environment_Context"],
      "properties": {
        "Current_ASM_Snapshot": {
          "type": "object",
          "description": "Snapshot of the Active System Memory (ASM) component states.",
          "required": ["artifact_id", "TEMM", "ECVM", "PVLM", "MPAM", "ADTM"],
          "properties": {
            "artifact_id": {"$ref": "#/$defs/ArtifactIdentifier", "const": "ASM"},
            "TEMM": {"$ref": "#/$defs/CryptographicHash", "description": "Trusted Execution Manager Model state hash."},
            "ECVM": {"$ref": "#/$defs/CryptographicHash", "description": "Execution Control Vector Map hash."},
            "PVLM": {"$ref": "#/$defs/CryptographicHash", "description": "Physical Virtual Link Map hash."},
            "MPAM": {"$ref": "#/$defs/CryptographicHash", "description": "Micro-Program Access Map hash."},
            "ADTM": {"$ref": "#/$defs/CryptographicHash", "description": "Autonomous Drift Tolerance Model hash."}
          }
        },
        "Active_Configuration_Roots": {
          "type": "object",
          "description": "Bundle of critical immutable configuration hashes.",
          "required": ["artifact_id", "CSR_Hash", "ACVD_Hash", "FASV_Hash", "EPB_Hash"],
          "properties": {
            "artifact_id": {"$ref": "#/$defs/ArtifactIdentifier", "const": "CR_Bundle"},
            "CSR_Hash": {"$ref": "#/$defs/CryptographicHash", "description": "Configuration Set Root Hash."},
            "ACVD_Hash": {"$ref": "#/$defs/CryptographicHash", "description": "Active Core Version Delta Hash."},
            "FASV_Hash": {"$ref": "#/$defs/CryptographicHash", "description": "Forensic Archive Security Vector Hash."},
            "EPB_Hash": {"$ref": "#/$defs/CryptographicHash", "description": "Execution Policy Bundle Hash."}
          }
        },
        "Execution_Environment_Context": {
          "type": "object",
          "description": "Runtime metrics and log snippets leading to failure.",
          "required": ["artifact_id", "ResourceUtilizationMetrics", "ExecutionLogSlice"],
          "properties": {
            "artifact_id": {"$ref": "#/$defs/ArtifactIdentifier", "const": "EEC"},
            "ResourceUtilizationMetrics": {
              "type": "object",
              "description": "Time series metrics of compute/memory/IO usage. Structure left flexible.",
              "additionalProperties": true
            },
            "ExecutionLogSlice": {
              "type": "string",
              "description": "Log excerpt (Base64 encoded or validated plaintext).",
              "minLength": 10
            }
          }
        }
      }
    },
    "attestation": {
      "type": "object",
      "description": "Cryptographic proof of TEDS integrity and capture authority.",
      "required": ["signing_agent", "signature_payload"],
      "properties": {
        "signing_agent": {
          "type": "string",
          "const": "CRoT",
          "description": "The designated signing authority (CRoT - Core Root of Trust)."
        },
        "signing_mandate": {
          "type": "string",
          "description": "Mandate identifier or summary."
        },
        "signature_payload": {
          "$ref": "#/$defs/SignaturePayload"
        }
      }
    }
  }
}