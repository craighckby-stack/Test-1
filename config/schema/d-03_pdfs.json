{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "http://sovereign.agi/d-03_pdfs_v2.0.json",
  "title": "D-03 Post-Deployment Feedback Schema (PDFS)",
  "description": "Structured data schema for capturing precise, temporally-bound real-world performance metrics and efficacy validation post-M-02 deployment (GSEP Stage 6). Essential for iterative refinement of S-01 Trust models and P-04 Policy enforcement.",
  "type": "object",
  "properties": {
    "metadata": {
      "type": "object",
      "description": "General contextual data about the feedback event.",
      "properties": {
        "M02_ID": { "type": "string", "description": "ID of the deployed Mutation Payload (M-02)." },
        "PMH_Reference": { "type": "string", "description": "Hashed reference to the Payload Manifest (P-03)." },
        "deployment_start_iso": { "type": "string", "format": "date-time", "description": "ISO 8601 timestamp when M-02 became active." },
        "feedback_capture_end_iso": { "type": "string", "format": "date-time", "description": "ISO 8601 timestamp marking the end of the monitoring window." }
      },
      "required": ["M02_ID", "PMH_Reference", "deployment_start_iso", "feedback_capture_end_iso"]
    },
    "Validation_Report": {
      "type": "object",
      "description": "Detailed assessment of target achievement.",
      "properties": {
        "success_status": {
          "type": "string",
          "enum": ["SUCCESS", "PARTIAL_SUCCESS", "CRITICAL_FAILURE", "REGRESSION"],
          "description": "Overall outcome categorization using AGI standard statuses."
        },
        "target_met": { "type": "boolean", "description": "Did the M-02 strictly meet the primary quantitative performance target defined in the P-03 manifest?" },
        "observed_performance_metric": { "type": "number", "description": "The key performance metric observed in the field." },
        "initial_target_metric": { "type": "number", "description": "The required performance metric defined pre-deployment." }
      },
      "required": ["success_status", "target_met", "observed_performance_metric", "initial_target_metric"]
    },
    "Drift_Analysis": {
      "type": "object",
      "description": "Metrics quantifying deviation from predictive models (S-01 Trust Model).",
      "properties": {
        "S01_Simulation_Drift_Percentage": {
          "type": "number",
          "minimum": 0,
          "description": "Absolute percentage deviation between simulated S-01 expectation and observed real-world efficacy (0-100)."
        },
        "Trust_Model_Required_Retrain": { "type": "boolean", "description": "Flag indicating if this feedback mandates immediate S-01 retraining/recalibration." }
      },
      "required": ["S01_Simulation_Drift_Percentage", "Trust_Model_Required_Retrain"]
    },
    "Policy_Enforcement": {
      "type": "object",
      "properties": {
        "Policy_Compliance_Incidents": {
          "type": "integer",
          "minimum": 0,
          "description": "Count of non-fatal compliance breaches observed (related to P-04 policy stack)."
        },
        "Critical_Security_Breaches": {
          "type": "integer",
          "minimum": 0,
          "description": "Count of fatal or critical security/safety breaches observed."
        }
      },
      "required": ["Policy_Compliance_Incidents", "Critical_Security_Breaches"]
    },
    "Resource_Delta": {
      "type": "object",
      "properties": {
        "CPU_Utilization_Change_Percentage": { "type": "number", "description": "Observed change in CPU utilization (relative percentage change)." },
        "Memory_Footprint_Change_MB": { "type": "number", "description": "Observed change in absolute memory usage (Megabytes)." }
      },
      "description": "Observed change in resource utilization relative to the baseline state (pre-M-02)."
    },
    "Failure_Mode_Analysis": {
      "type": "array",
      "description": "Structured breakdown of root causes if validation failed or performance degraded. Uses codified FMA keys.",
      "items": {
        "type": "object",
        "properties": {
          "code": { "type": "string", "description": "AGI internal failure mode code (FMA key)." },
          "description": { "type": "string" },
          "severity": { "type": "string", "enum": ["HIGH", "MEDIUM", "LOW"] }
        },
        "required": ["code", "severity"]
      },
      "minItems": 0
    }
  },
  "required": ["metadata", "Validation_Report", "Drift_Analysis", "Policy_Enforcement", "Resource_Delta"]
}