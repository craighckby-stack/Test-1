class LifecycleState {
  #state

  get configured() {
    return this.#state.configured;
  }

  set configured(value) {
    this.#state.configured = value;
  }

  get loaded() {
    return this.#state.loaded;
  }

  set loaded(value) {
    this.#state.loaded = value;
  }

  get shuttingDown() {
    return this.#state.shuttingDown;
  }

  set shuttingDown(value) {
    this.#state.shuttingDown = value;
  }
}

class LifecycleHandler {
  #handler;

  constructor() {
    this.#handler = {
      configure: (config) => console.log(`Configure with: ${config}`),
      load: () => console.log("Loading..."),
      shutdown: () => console.log("Shutdown initiated..."),
      shutdown_: () => {}
    };
  }

  configure(config) {
    this.#handler.configure(config);
  }

  load() {
    this.#handler.load();
  }

  shutdown_() {
    this.#handler.shutdown_();
  }

  shutdown() {
    this.#handler.shutdown();
  }
}

class NexusCore {
  #lifecycleState = new LifecycleState();
  #status = '';

  static get instance() {
    return this.instance_ || (this.instance_ = new NexusCore());
  }

  get status() {
    return this.#status;
  }

  set status(value) {
    this.#status = value;
  }

  get lifecycleState() {
    return this.#lifecycleState;
  }

  async configure(config) {
    if (this.#lifecycleState.configured) {
      throw new Error('NexusCore already configured');
    }
    await this.#validateConfig(config);
    this.#lifecycleState.configured = true;
    this.status = 'CONFIGURED';
  }

  async load() {
    if (this.#lifecycleState.loaded) {
      throw new Error('NexusCore already loaded');
    }
    await this.#lifecycleState.handler.load();
    await new Promise(resolve => setTimeout(resolve, 1000));
    this.#lifecycleState.loaded = true;
    this.status = 'LOADED';
  }

  async shutdown() {
    if (!this.#lifecycleState.shuttingDown) {
      console.log("Shutdown initiated...");
      this.#lifecycleState.shuttingDown = true;
      try {
        await this.#lifecycleState.handler.shutdown_();
        console.log("Shutdown complete...");
      } catch (error) {
        console.error('Error shutting down NexusCore:', error);
      }
      this.status = 'SHUTDOWN';
    }
  }

  async shutdown_() {
    this.#lifecycleState.handler.shutdown_();
  }

  async stop() {
    this.status = 'STOPPED';
  }

  async destroy() {
    this.#lifecycleState = new LifecycleState();
    this.status = 'DESTROYED';
  }

  async start() {
    await this.#lifecycleState.handler.configure('Configured');
  }

  #validateConfig(config) {
    // validate config
  }
}

class Config {
  #configSchema = {
    VERSION: "1.0.0",
    env: "development"
  };

  static get instance() {
    return this.instance_ || (this.instance_ = new Config());
  }

  get config() {
    return this.#config;
  }

  set config(value) {
    this.#config = value;
  }

  #config = null;

  get configSchema() {
    return this.#configSchema;
  }

  set configSchema(value) {
    this.#configSchema = value;
  }

  async validate() {
    const validator = new Validator();
    validator.checkSchema(this.#configSchema);
    const result = await validator.validateAsync(this.#config, this.#configSchema);
    if (result.valid) {
      console.log('Config validated successfully');
    } else {
      throw new Error(`Config validation failed: ${result.errors[0].message}`);
    }
  }
}

class ConfigManager extends Config {
  #configPath;
  #configLoader;

  static get instance() {
    return this.instance_ || (this.instance_ = new ConfigManager());
  }

  constructor() {
    super();
    this.#configLoader = { loadConfig: async () => ({}) };
    this.#configPath = {
      async #configPath() {
        let path = '';
        try {
          console.log("Config Path");
        } catch (err) {
          console.error(err);
        }
      }
    };
  }

  async #init() {
    await this.#configPath.#configPath();
  }

  async loadConfig() {
    await this.#init();
    if (this.#config) {
      console.log('Config Loaded');
      return this.#config;
    }
    const loader = await this.#loadConfig();
    console.log('Loading default');
    return loader.loadConfig();
  }

  #loadConfig() {
    // load config from file
  }
}

class Loader extends LifecycleHandler {
  constructor() {
    super();
    this.#loaderConfig(config => {
      console.log(`Loader with config: ${config}`);
    });
  }

  async configure(config) {
    await super.configure(config);
  }

  #loaderConfig(cb) {
    cb('Loaded');
  }
}

class Loader2 extends Loader {
  #loaderConfig(cb) {
    cb('Loaded 2');
  }
}

class Validator {
  #checkSchema;
  #validate;

  constructor() {
    console.log("Validating");
    this.#checkSchema = async (schema, config) => console.log(`Validate schema and config: ${schema} ${config}`);
    this.#validate = async (config, schema) => console.log(`Validate config: ${config} ${schema}`);
  }

  checkSchema(schema) {
    return this.#checkSchema(schema, schema);
  }

  async validateAsync(config, schema) {
    return this.#validate(config, schema);
  }
}

class PathResolver {
  #path;

  constructor() {
    this.#path = '/'
  }

  async #resolve(p) {
    return `${this.#path}/${p}`;
  }

  async resolve(directory) {
    return await this.#resolve(directory);
  }
}

// Usage
// Main class
class Main {
  static async main() {
    try {
      const nexusCore = new NexusCore();
      await nexusCore.configure({ config: 'Configured' });
      await new ConfigManager().loadConfig();
      await nexusCore.load();
      await nexusCore.shutdown();
      await nexusCore.destroy();
    } catch (err) {
      console.error('Main error:', err);
    }
  }
}

// Main execution
Main.main();