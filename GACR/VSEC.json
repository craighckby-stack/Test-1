class AbstractModel {
  #model;

  constructor(data) {
    this.#model = {};
    if (data) {
      this.#mergeConfig(this.#model, data);
    }
  }

  get model() {
    return this.#model;
  }

  #mergeConfig(target, ...sources) {
    sources.forEach(source => Object.assign(target, source));
    return target;
  }
}

class ConfigModel extends AbstractModel {
  constructor(data) {
    super();
    const defaultConfig = {
      VERSION: "1.0.0",
      env: process.env.NODE_ENV || "development"
    };

    this.#model = this.#mergeConfig(defaultConfig, data);
  }
}

class ConfigValidator {
  constructor(schema) {
    this.schema = schema;
    this.validator = new Validator();
  }

  validate(values) {
    if (typeof values !== 'object') {
      throw new Error('Invalid configuration: must be an object');
    }
    try {
      this.validator.checkSchema(this.schema);
      this.validator.validate(values, this.schema);
      return values;
    } catch (e) {
      console.error('Config validation error:', e);
      throw e;
    }
  }
}

class LifecycleEvent {
  constructor(event) {
    this.event = event;
  }
}

class LifecycleHandler {
  constructor(handler, target) {
    this.handler = handler;
    this.target = target;
    this.binded = false;
  }

  bind() {
    if (!this.binded) {
      this.handler = this.handler.bind(this.target);
      this.binded = true;
    }
  }

  execute() {
    this.handler();
  }
}

class NexusCore {
  #status;
  #lifecycle;
  #config;

  constructor() {
    this.#status = "INIT";
    this.#lifecycle = {
      lifecycleEvents: new Map(),
      configured: false,
      loaded: false
    };
  }

  get status() {
    return this.#status;
  }

  get lifecycle() {
    return this.#lifecycle;
  }

  get config() {
    return this.#config;
  }

  set config(value) {
    this.#config = value;
  }

  async configure(config) {
    const validator = new ConfigValidator({
      type: 'object',
      properties: {
        VERSION: { type: 'string' },
        env: { type: 'string' }
      },
      required: ['VERSION', 'env']
    });

    const validatedConfig = validator.validate(config);
    await new Promise(resolve => resolve());
    this.#status = "CONFIGURED";
    this.#lifecycle.configured = true;
    const lifecycleHandler = new LifecycleHandler(() => console.log("NexusCore instance configured."));
    lifecycleHandler.bind(this);
    this.#lifecycle.lifecycleEvents.set("CONFIGURED", lifecycleHandler);

    this.#config = validatedConfig;
  }

  async shutdown() {
    if (!this.#lifecycle.shuttingDown) {
      console.log("Shutdown initiated...");
      this.#lifecycle.shuttingDown = true;
      this.#status = 'SHUTTING_DOWN';
      const lifecycleHandler = new LifecycleHandler(() => {
        console.log("NexusCore instance is shutting down...");
      });
      lifecycleHandler.bind(this);
      this.#lifecycle.lifecycleEvents.set("SHUTTING_DOWN", lifecycleHandler);
      console.log("Shutdown complete...");
      this.#lifecycle.shuttingDown = false;
      this.#status = 'SHUTDOWN';
      this.#lifecycle.loaded = false;
      this.#lifecycle.configured = false;
      this.#config = null;
    }
  }

  on(event, handler) {
    const lifecycleHandler = new LifecycleHandler(handler, this);
    this.#lifecycle.lifecycleEvents.set(event, lifecycleHandler);
  }

  get lifecycleEvents() {
    return this.#lifecycle.lifecycleEvents;
  }

  async executeLifecycleEvent(event) {
    if (this.#lifecycle.lifecycleEvents.has(event)) {
      const lifecycleHandler = this.#lifecycle.lifecycleEvents.get(event);
      lifecycleHandler.bind(this);
      lifecycleHandler.execute();
    }
  }

  async load() {
    try {
      console.log("Loading...");
      await new Promise(resolve => setTimeout(resolve, 1000));
      console.log("Loading complete...");
      this.#lifecycle.loaded = true;
      this.executeLifecycleEvent("LOADED");
    } catch (e) {
      console.error('Load error:', e);
    }
  }

  async start() {
    await this.configure();
    await this.load();
    this.#status = "RUNNING";
  }

  async destroy() {
    this.#status = "DESTROYED";
    this.#lifecycle = {
      lifecycleEvents: new Map(),
      configured: false,
      loaded: false,
      shuttingDown: false
    };
    this.#config = null;
  }
}

const staticConfig = {
  VERSION: "1.0.0",
  env: process.env.NODE_ENV || "development"
};

const nexusCore = new NexusCore();

nexusCore.on("INIT", async () => {
  console.log("NexusCore instance initialized.");
});

nexusCore.on("CONFIGURED", async () => {
  console.log("NexusCore instance configured.");
});

nexusCore.on("LOADED", async () => {
  console.log("NexusCore instance loaded.");
});

nexusCore.on("SHUTTING_DOWN", async () => {
  console.log("NexusCore instance is shutting down...");
});

nexusCore.on("SHUTDOWN", async () => {
  console.log("NexusCore shutdown completed.");
});

nexusCore.configure({ foo: 'bar', baz: true });
nexusCore.start();
nexusCore.shutdown();
nexusCore.destroy();