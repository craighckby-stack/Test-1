{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "spec_id": "NRALS_REG_V2.0",
  "title": "NRALS Manifest Hash Registration Service Contract (Evolved)",
  "version": "2.0",
  "description": "Defines the mandatory contract for registering new cryptographic hash manifests with the NRALS Ledger, ensuring consistency with enterprise asset type classification and prerequisite for MCIS integrity verification.",
  "service_urn": "urn:gac-sys:service:gacrs:manifest-registration",
  "$defs": {
    "AssetTypeEnum": {
      "type": "string",
      "enum": [
        "CAC",
        "CFTM",
        "PVLM",
        "SIHM",
        "FSVM",
        "GOV_POLICY"
      ],
      "description": "Standardized enumeration of critical asset manifest types. Referenced from spec/common/asset_classification_v1.json."
    },
    "RegistrationError": {
      "type": "object",
      "properties": {
        "code": {
          "type": "string",
          "description": "Error classification code (e.g., LEDGER_REJECT, AUTH_FAIL)."
        },
        "message": {
          "type": "string",
          "description": "Human-readable error description."
        },
        "details": {
          "type": "object"
        }
      },
      "required": [
        "code",
        "message"
      ]
    },
    "HashManifestInput": {
      "type": "object",
      "properties": {
        "manifest_id": {
          "type": "string",
          "format": "uuid",
          "description": "Unique identifier for the manifest structure."
        },
        "content_hash": {
          "type": "string",
          "format": "hex",
          "minLength": 128,
          "maxLength": 128,
          "description": "Cryptographic hash (SHA-512 recommended and constrained to 128 hex characters)."
        },
        "asset_type": {
          "$ref": "#/$defs/AssetTypeEnum"
        },
        "committer_signature": {
          "type": "string",
          "format": "JWS",
          "description": "JWS confirming transaction authenticity and committer identity."
        }
      },
      "required": [
        "manifest_id",
        "content_hash",
        "asset_type",
        "committer_signature"
      ],
      "additionalProperties": false
    },
    "RegistrationOutput": {
      "type": "object",
      "properties": {
        "success": {
          "type": "boolean"
        },
        "transaction_id": {
          "type": "string",
          "description": "Unique ID of the ledger transaction."
        },
        "ledger_block_ref": {
          "type": "string",
          "description": "Reference pointer to the committed block on the ledger."
        },
        "error": {
          "$ref": "#/$defs/RegistrationError"
        }
      },
      "required": [
        "success"
      ],
      "if": {
        "properties": {
          "success": {
            "const": true
          }
        }
      },
      "then": {
        "required": [
          "transaction_id",
          "ledger_block_ref"
        ]
      },
      "else": {
        "required": [
          "error"
        ]
      }
    }
  },
  "registration_requirements": {
    "immutable": true,
    "transaction_mechanism": "LEDGER_COMMIT",
    "authorization_level": "GOVERNANCE_EXEC",
    "verification_policy_urn": "urn:gac-sys:policy:gov_exec_signature_v1"
  },
  "contracts": {
    "input_schema": {
      "$ref": "#/$defs/HashManifestInput"
    },
    "output_schema": {
      "$ref": "#/$defs/RegistrationOutput"
    }
  }
}