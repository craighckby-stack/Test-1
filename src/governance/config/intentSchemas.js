The TARGET_CODE was provided, and no apparent bugs were found. However, I will provide the code with some improvements for readability and maintainability.