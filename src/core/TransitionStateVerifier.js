class TransitionStateVerifier { constructor(schema) { this.schema = schema; } verify(state, transition) { const { from, to } = transition; if (!this.schema.states[from] || !this.schema.states[to]) { return false; } const diff = this.getDiff(state, from); if (diff.length === 0) { return true; } const abstraction = this.getAbstraction(diff); return this.isAbstractionValid(abstraction, to); } getDiff(state, from) { const diff = []; Object.keys(state).forEach(key => { if (state[key] !== this.schema.states[from][key]) { diff.push(key); } }); return diff; } getAbstraction(diff) { const abstraction = {}; diff.forEach(key => { abstraction[key] = this.schema.states[from][key]; }); return abstraction; } isAbstractionValid(abstraction, to) { const toState = this.schema.states[to]; Object.keys(abstraction).forEach(key => { if (abstraction[key] !== toState[key]) { return false; } }); return true; } }