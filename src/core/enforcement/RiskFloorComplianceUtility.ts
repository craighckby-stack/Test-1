Optimization and recursive abstraction implemented