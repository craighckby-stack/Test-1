{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Sovereign AGI Operational Telemetry Schema v94.1",
  "description": "Defines structured telemetry and outcome metrics required to calculate the Autonomous Efficiency Score (AES) for a given evolution cycle.",
  "type": "object",
  "definitions": {
    "PositiveInteger": {
      "type": "integer",
      "minimum": 0
    },
    "NonNegativeNumber": {
        "type": "number",
        "minimum": 0
    },
    "Percentage": {
      "type": "number",
      "minimum": 0.0,
      "maximum": 1.0
    }
  },
  "properties": {
    "cycle_id": {
      "type": "string",
      "description": "Unique identifier for the current evolution cycle.",
      "minLength": 1
    }, 
    "timestamp_utc": {
      "type": "string",
      "format": "date-time",
      "description": "UTC timestamp of the completion of the operational cycle."
    },
    "resource_metrics": {
      "type": "object",
      "description": "Measures usage of core computation and external service resources.",
      "properties": {
        "input_tokens": {"$ref": "#/definitions/PositiveInteger"},
        "output_tokens": {"$ref": "#/definitions/PositiveInteger"},
        "api_calls_count": {"$ref": "#/definitions/PositiveInteger", "description": "Total number of external API calls (e.g., LLM inferences, DB queries)."},
        "total_latency_ms": {"$ref": "#/definitions/NonNegativeNumber", "description": "Total wall-clock latency for the cycle."}, 
        "peak_memory_mb": {"$ref": "#/definitions/NonNegativeNumber"}
      },
      "required": [
        "input_tokens",
        "output_tokens",
        "total_latency_ms",
        "api_calls_count"
      ]
    },
    "evolution_stability": {
      "type": "object",
      "description": "Measures the structural impact and stability of the changes applied.",
      "properties": {
        "files_modified_count": {"$ref": "#/definitions/PositiveInteger"},
        "successful_hunks": {"$ref": "#/definitions/PositiveInteger", "description": "Hunks applied successfully without immediate revision."}, 
        "reverted_hunks": {"$ref": "#/definitions/PositiveInteger", "description": "Hunks that required rollback within the cycle."}, 
        "total_patch_size_lines": {"$ref": "#/definitions/PositiveInteger", "description": "Total lines added/removed across all patches."}, 
        "unit_test_result": {"type": "string", "enum": ["PASS", "FAIL", "SKIP"], "description": "Result of the integrated unit test suite run after modification."}
      },
      "required": [
        "files_modified_count",
        "successful_hunks",
        "unit_test_result"
      ]
    },
    "quality_assurance": {
      "type": "object",
      "description": "Metrics related to code quality and verification.",
      "properties": {
        "test_coverage_before": {"$ref": "#/definitions/Percentage"},
        "test_coverage_after": {"$ref": "#/definitions/Percentage"},
        "linter_warnings_delta": {"type": "integer", "description": "Change in linter warnings count (After - Before)."}
      },
      "required": [
        "test_coverage_before",
        "test_coverage_after"
      ]
    },
    "objective_outcome": {
        "type": "object",
        "description": "Metrics capturing the success or failure relative to the defined mission objective.",
        "properties": {
            "is_success": {"type": "boolean"},
            "error_classification": {"type": "string", "enum": ["NONE", "MISINTERPRETATION", "RESOURCE_EXHAUSTION", "CODE_REVERSION_LIMIT", "LLM_HALLUCINATION"], "description": "Standardized reason for failure, referencing the official error weight profile."},
            "efficiency_penalty_applied": {"$ref": "#/definitions/Percentage", "description": "A calculated penalty score (0.0 to 1.0) based on the severity of errors or partial fulfillment."}
        },
        "required": [
            "is_success",
            "error_classification"
        ]
    }
  },
  "required": [
    "cycle_id",
    "timestamp_utc",
    "resource_metrics",
    "evolution_stability",
    "quality_assurance",
    "objective_outcome"
  ],
  "additionalProperties": false
}