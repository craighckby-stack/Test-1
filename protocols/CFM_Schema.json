{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://agi.sovereign/protocols/CFM_Schema.json",
  "title": "Constraint Failure Manifest (CFM)",
  "description": "Standardized schema generated by GFRM upon GSEP constraint failure (FAIL_N-1).",
  "type": "object",
  "required": ["timestamp", "artifact_hash", "gsep_stage", "constraint_violation_id", "violation_details"],
  "properties": {
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "UTC time of failure detection."
    },
    "artifact_hash": {
      "type": "string",
      "description": "Cryptographic hash of the modification artifact that failed the stage."
    },
    "gsep_stage": {
      "type": "string",
      "enum": ["L0", "L1", "L2", "L3", "L4", "L5"],
      "description": "The GSEP stage (N-1) where the failure occurred."
    },
    "constraint_violation_id": {
      "type": "string",
      "description": "Identifier for the violated policy (e.g., SCR_SCHEMA_01, SBC_SCOPE_05, S-03_VETO)."
    },
    "violating_agent": {
      "type": "string",
      "description": "The agent responsible for running the failing check (e.g., SCR, AOC, HMC)."
    },
    "violation_details": {
      "type": "object",
      "description": "Detailed machine-readable context of the violation.",
      "required": ["severity", "error_message"],
      "properties": {
        "severity": {
          "type": "string",
          "enum": ["CRITICAL", "HIGH", "MEDIUM"],
          "description": "Severity assessment for required remediation."
        },
        "error_message": {
          "type": "string",
          "description": "The specific error message or log entry triggering the GFRM."
        },
        "metric_data": {
          "type": "object",
          "description": "Relevant metric values at time of failure (especially for L3/L4 failures)."
        }
      }
    }
  }
}