{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "MIS_V94_2_1.json",
  "title": "Mandate Intake Specification (MIS) - GSEP L0 Vetting (Refactored V2.1 - Enhanced Metrics)",
  "description": "Normalized structural requirements (C-FRAME) for all System State Transitions (SSTs). Enforced by SCR at GSEP L0. Updated for enhanced traceability and execution metrics.",
  "type": "object",
  "required": [
    "protocol",
    "sst_id",
    "version",
    "sst_metadata",
    "control_frame",
    "assessment_report",
    "execution_payload"
  ],
  "properties": {
    "version": {
      "type": "string",
      "const": "2.1.0",
      "description": "Protocol schema version (Minor revision for enhanced metric definition)."
    },
    "protocol": {
      "type": "string",
      "const": "MIS"
    },
    "sst_id": {
      "type": "string",
      "description": "Globally Unique Identifier (UUID v4) for this SST request.",
      "pattern": "^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$"
    },
    "sst_metadata": { "$ref": "#/$defs/SSTMetadata" },
    "control_frame": { "$ref": "#/$defs/ControlFrame" },
    "assessment_report": { "$ref": "#/$defs/AssessmentReport" },
    "execution_payload": { "$ref": "#/$defs/ExecutionPayload" }
  },
  "$defs": {
    "SSTMetadata": {
      "type": "object",
      "required": ["proposed_by", "timestamp", "rationale", "precedence_score"],
      "properties": {
        "proposed_by": { "type": "string", "description": "Identity of the proposing agent/system." },
        "timestamp": { "type": "string", "format": "date-time" },
        "rationale": { "type": "string", "description": "High-level summary of change intent (min 64 characters for thoroughness).", "minLength": 64 },
        "precedence_score": {
          "type": "integer",
          "minimum": 1,
          "maximum": 100,
          "description": "System calculated or requested priority score for scheduling (1=Low, 100=Urgent)."
        }
      }
    },
    "ControlFrame": {
      "type": "object",
      "required": ["target_component", "type", "integrity_hash_sha256", "risk_exposure_level", "execution_priority"],
      "properties": {
        "target_component": { "type": "string", "description": "The specific logical component being modified (e.g., SCR, GSEP, EEP, CORE_LIB)." },
        "type": {
          "type": "string",
          "enum": ["FEATURE_EVOLUTION", "CRITICAL_HOTFIX", "CONFIG_ADJUSTMENT"],
          "description": "Refined classifications: Feature (new capability), Hotfix (urgent remediation), Config (non-code metadata)."
        },
        "integrity_hash_sha256": {
          "type": "string",
          "description": "Cryptographic hash (SHA-256) of the execution_payload's base64 content BEFORE decoding.",
          "pattern": "^[a-fA-F0-9]{64}$"
        },
        "risk_exposure_level": {
          "type": "string",
          "enum": ["L0_ISOLATED", "L1_LOCALIZED", "L2_SYSTEMIC_CRITICAL"],
          "description": "Classification of potential failure radius and severity: L0 (Self-contained), L1 (Local component ripple), L2 (Core system risk)."
        },
        "execution_priority": {
            "type": "string",
            "enum": ["SCHEDULED", "IMMEDIATE", "ATOMIC"],
            "description": "Indicates execution urgency: SCHEDULED (Standard queue), IMMEDIATE (Bypass queue, high vetting), ATOMIC (Mandated system restart required)."
        }
      }
    },
    "AssessmentReport": {
      "type": "object",
      "required": ["estimated_efficacy_score", "estimated_risk_score", "evaluation_engine_id"],
      "properties": {
        "estimated_efficacy_score": {
          "type": "number",
          "minimum": 0.00,
          "maximum": 1.00,
          "description": "Estimated success probability/efficacy (0.00 to 1.00)."
        },
        "estimated_risk_score": {
          "type": "number",
          "minimum": 0.00,
          "maximum": 1.00,
          "description": "Estimated system risk score (0.00 to 1.00)."
        },
        "evaluation_engine_id": {
            "type": "string",
            "description": "Version identifier of the assessment engine (S01/S02) used to generate these scores, ensuring verifiability."
        },
        "override_justification": {
          "type": ["string", "null"],
          "description": "Required only if scores trigger high-deviation flags (e.g., Risk > 0.7 or Efficacy < 0.6). Min length 100 characters for critical overrides.",
          "minLength": 100
        }
      }
    },
    "ExecutionPayload": {
      "type": "object",
      "required": ["target_path", "diff_content_base64", "payload_type", "encoded_size_bytes"],
      "properties": {
        "target_path": { "type": "string", "description": "The exact internal file path targeted for modification." },
        "payload_type": {
            "type": "string",
            "enum": ["TEXT_DIFF", "JSON_PATCH", "FULL_OVERWRITE"],
            "description": "Format specification for applying diff_content."
        },
        "diff_content_base64": {
          "type": "string",
          "description": "The actual payload content, guaranteed safe for transport via Base64 encoding."
        },
        "encoded_size_bytes": {
            "type": "integer",
            "minimum": 1,
            "maximum": 1048576,
            "description": "Size of the base64 encoded payload in bytes. Used for early ingress throttling (1MB max)."
        }
      }
    }
  }
}