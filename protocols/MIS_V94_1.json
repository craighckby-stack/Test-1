{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "MIS_V94_2.json",
  "title": "Mandate Intake Specification (MIS) - GSEP L0 Vetting (Refactored V2)",
  "description": "Normalized structural requirements (C-FRAME) for all System State Transitions (SSTs). Enforced by SCR at GSEP L0. Updated for strict numerical boundaries and definition separation.",
  "type": "object",
  "required": [
    "protocol",
    "sst_id",
    "version",
    "metadata",
    "c_frame",
    "compliance_statement",
    "mandated_payload"
  ],
  "properties": {
    "version": {
      "type": "string",
      "const": "2.0.0",
      "description": "Protocol schema version."
    },
    "protocol": {
      "type": "string",
      "const": "MIS"
    },
    "sst_id": {
      "type": "string",
      "description": "Globally Unique Identifier (UUID v4 structure recommended) for this SST request.",
      "pattern": "^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$"
    },
    "metadata": { "$ref": "#/$defs/Metadata" },
    "c_frame": { "$ref": "#/$defs/CFrame" },
    "compliance_statement": { "$ref": "#/$defs/ComplianceStatement" },
    "mandated_payload": { "$ref": "#/$defs/MandatedPayload" }
  },
  "$defs": {
    "Metadata": {
      "type": "object",
      "required": ["proposed_by", "timestamp", "rationale"],
      "properties": {
        "proposed_by": { "type": "string", "description": "Identity of the proposing agent/system." },
        "timestamp": { "type": "string", "format": "date-time" },
        "rationale": { "type": "string", "description": "High-level summary of change intent (min 50 characters).", "minLength": 50 }
      }
    },
    "CFrame": {
      "type": "object",
      "required": ["target_component", "type", "code_patch_integrity_hash", "scope_impact"],
      "properties": {
        "target_component": { "type": "string", "description": "The specific logical component being modified (e.g., SCR, GSEP, EEP)." },
        "type": {
          "type": "string",
          "enum": ["EVOLUTION", "HOTFIX", "CONFIG_UPDATE"],
          "description": "EVOLUTION: Feature addition/optimization. HOTFIX: Urgent bug resolution. CONFIG_UPDATE: Non-code configuration modification."
        },
        "code_patch_integrity_hash": {
          "type": "string",
          "description": "Cryptographic hash (SHA-256) of the mandated_payload content BEFORE base64 decoding/parsing.",
          "pattern": "^[a-fA-F0-9]{64}$"
        },
        "scope_impact": {
          "type": "string",
          "enum": ["L0_ISOLATED", "L1_COMPONENT", "L2_SYSTEMIC"],
          "description": "Classification of potential failure radius and risk: LOW (L0), MEDIUM (L1), or HIGH (L2). Refined terminology for precision."
        }
      }
    },
    "ComplianceStatement": {
      "type": "object",
      "required": ["estimated_efficacy_s01", "estimated_risk_s02"],
      "properties": {
        "estimated_efficacy_s01": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 1.0,
          "description": "Estimated success probability/efficacy (0.0 to 1.0)."
        },
        "estimated_risk_s02": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 1.0,
          "description": "Estimated system risk score (0.0 to 1.0)."
        },
        "override_justification": {
          "type": ["string", "null"],
          "description": "Required only if S01/S02 trigger high-deviation flags (e.g., Risk > 0.8 or Efficacy < 0.5).",
          "minLength": 50
        }
      }
    },
    "MandatedPayload": {
      "type": "object",
      "required": ["file_path", "diff_content", "payload_format"],
      "properties": {
        "file_path": { "type": "string", "description": "Path to the file targeted for modification." },
        "payload_format": {
            "type": "string",
            "enum": ["TEXT_DIFF", "JSON_PATCH", "FULL_OVERWRITE"],
            "description": "Format of the content provided in diff_content."
        },
        "diff_content": {
          "type": "string",
          "description": "The actual payload content, base64 encoded."
        }
      }
    }
  }
}