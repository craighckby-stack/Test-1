{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "urn:sovereign:schema:governance:CertifiedOperationalTelemetrySchema",
  "title": "Certified Operational Telemetry Schema (COTS)",
  "description": "Standardized schema for recording non-critical, high-frequency operational metrics and environment data during P3 Audit & Metric Calculation cycles (S07-S10). Essential for autonomous performance optimization, system health monitoring, and compliance tracking.",
  "type": "object",
  "$defs": {
    "SystemResourceMetrics": {
      "type": "object",
      "description": "Core system resource consumption metrics (CPU, Memory, I/O).",
      "properties": {
        "latency_ms": {
          "type": "number",
          "description": "Total execution time (wall clock) in milliseconds for the tracked scope."
        },
        "cpu_utilization_percent": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Average CPU utilization percentage."
        },
        "memory_footprint_bytes": {
          "type": "integer",
          "format": "int64",
          "description": "Peak memory consumption in bytes."
        },
        "io_read_bytes": {
          "type": "integer",
          "format": "int64",
          "description": "I/O bytes read during the operational window."
        },
        "io_write_bytes": {
          "type": "integer",
          "format": "int64",
          "description": "I/O bytes written during the operational window."
        }
      },
      "required": [
        "latency_ms",
        "cpu_utilization_percent",
        "memory_footprint_bytes"
      ]
    },
    "DataLayerMetrics": {
      "type": "object",
      "description": "Runtime Query Layer (RQL) specific interaction and caching metrics.",
      "properties": {
        "read_operations": {
          "type": "integer",
          "format": "int32",
          "description": "Number of successful RQL read operations."
        },
        "write_operations": {
          "type": "integer",
          "format": "int32",
          "description": "Number of successful RQL write operations."
        },
        "cache_hits": {
          "type": "integer",
          "format": "int32"
        },
        "cache_misses": {
          "type": "integer",
          "format": "int32"
        },
        "peak_queue_depth": {
          "type": "integer",
          "format": "int32",
          "description": "Maximum concurrent pending RQL requests observed."
        }
      },
      "required": [
        "read_operations",
        "write_operations",
        "cache_hits",
        "cache_misses"
      ]
    },
    "EngineProcessMetrics": {
      "type": "object",
      "description": "Metrics relating to internal decision loops and algorithmic efficiency.",
      "properties": {
        "optimization_cycles_executed": {
          "type": "integer",
          "format": "int32",
          "description": "Count of self-correction, planning, or optimization loops executed."
        },
        "decision_points_resolved": {
          "type": "integer",
          "format": "int32",
          "description": "Count of major branching decision points processed."
        }
      },
      "required": [
        "optimization_cycles_executed",
        "decision_points_resolved"
      ]
    },
    "ExecutionOutcome": {
      "type": "object",
      "description": "Status and basic error reporting for the measured operational window.",
      "properties": {
        "status": {
          "type": "string",
          "enum": [
            "SUCCESS",
            "FAILURE_RECOVERABLE",
            "FAILURE_FATAL"
          ],
          "description": "The resulting status of the measured operational scope."
        },
        "error_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Count of non-fatal exceptions or errors handled internally."
        }
      },
      "required": [
        "status"
      ]
    }
  },
  "properties": {
    "execution_uuid": {
      "type": "string",
      "format": "uuid",
      "description": "Unique identifier linking this telemetry batch to the parent GSEP-C execution cycle."
    },
    "timestamp_utc": {
      "type": "string",
      "format": "date-time",
      "description": "Time of telemetry generation."
    },
    "agent_source": {
      "type": "string",
      "description": "The specific internal component or agent generating the telemetry (e.g., RQL-Cache, SGS-Planner). The CTAS prefix is reserved for aggregated data.",
      "pattern": "^(SGS|GAX|ARC|PVM|RQL|CTAS)-[A-Z0-9]{2,10}$"
    },
    "context_hash": {
      "type": "string",
      "format": "sha256",
      "description": "Cryptographic hash identifying the exact input state/context that produced these metrics. Essential for performance correlation and audit trail."
    },
    "operational_metrics": {
      "type": "object",
      "description": "A comprehensive collection of operational performance and behavior metrics.",
      "properties": {
        "resources": {
          "$ref": "#/$defs/SystemResourceMetrics",
          "description": "Detailed physical system resource utilization."
        },
        "data_layer": {
          "$ref": "#/$defs/DataLayerMetrics",
          "description": "Statistics on RQL/persistence layer interactions."
        },
        "engine_process": {
          "$ref": "#/$defs/EngineProcessMetrics",
          "description": "Internal algorithm and process counters."
        },
        "outcome": {
          "$ref": "#/$defs/ExecutionOutcome",
          "description": "The result status of the operational window."
        }
      },
      "required": [
        "resources",
        "data_layer",
        "engine_process",
        "outcome"
      ]
    },
    "intermediate_results_hash": {
      "type": "string",
      "format": "sha256",
      "description": "Optional hash of complex intermediate results (for data validation during audit).
            A key metric for Audit Layer validation."
    }
  },
  "required": [
    "execution_uuid",
    "timestamp_utc",
    "agent_source",
    "context_hash",
    "operational_metrics"
  ]
}