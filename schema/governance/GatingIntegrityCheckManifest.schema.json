{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://agi.sovereign.v94/schema/governance/GatingIntegrityCheckManifest.schema.json",
  "title": "Sovereign AGI Gating Integrity Check Manifest",
  "description": "Defines rules and actions for governance gating checks applied before deployment, merge, or activation.",
  "type": "object",
  "properties": {
    "manifestVersion": {
      "type": "string",
      "format": "semver",
      "description": "The schema version this manifest adheres to."
    },
    "scope": {
      "type": "string",
      "description": "Defines the area of applicability (e.g., 'Core/AI', 'UI/Client', 'Global').",
      "enum": [
        "Global",
        "Module:*",
        "Service:*",
        "Deployment:*"
      ]
    },
    "defaultActionPolicy": {
      "$ref": "#/$defs/ActionPolicy"
    },
    "checks": {
      "type": "array",
      "description": "List of integrity checks to perform.",
      "items": {
        "$ref": "#/$defs/CheckDefinition"
      },
      "minItems": 1
    }
  },
  "required": [
    "manifestVersion",
    "scope",
    "checks"
  ],
  "$defs": {
    "SeverityLevel": {
      "type": "string",
      "enum": [
        "CRITICAL",
        "HIGH",
        "MODERATE",
        "ADVISORY"
      ],
      "description": "The consequence severity if the check fails."
    },
    "ActionPolicy": {
      "type": "object",
      "properties": {
        "onFail": {
          "type": "string",
          "description": "Action taken when the check fails.",
          "enum": [
            "BLOCK_MERGE",
            "BLOCK_DEPLOY",
            "LOG_WARNING",
            "AUTO_REMEDIATE"
          ]
        },
        "notifyGroup": {
          "type": "string",
          "description": "Communication target identifier (e.g., slack channel or email list)."
        }
      },
      "required": [
        "onFail"
      ]
    },
    "CheckDefinition": {
      "type": "object",
      "properties": {
        "checkId": {
          "type": "string",
          "description": "Unique identifier for the integrity check."
        },
        "description": {
          "type": "string"
        },
        "severity": {
          "$ref": "#/$defs/SeverityLevel"
        },
        "targetPath": {
          "type": "string",
          "format": "json-path",
          "description": "JSON path, file path, or configuration key targeted by the check."
        },
        "checkType": {
          "type": "string",
          "enum": [
            "SEMANTIC_VERSION",
            "SECRET_SCAN",
            "LICENSING",
            "SCHEMA_COMPLIANCE",
            "HARDENING_FLAG"
          ]
        },
        "configuration": {
          "type": "object",
          "description": "Specific parameters required by the checkType (e.g., expected regex, required value)."
        },
        "actionPolicy": {
          "$ref": "#/$defs/ActionPolicy",
          "description": "Overrides the manifest's default action policy if specified."
        }
      },
      "required": [
        "checkId",
        "severity",
        "targetPath",
        "checkType"
      ]
    }
  }
}