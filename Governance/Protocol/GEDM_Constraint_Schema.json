{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "http://governance.agi/gedm/constraint-schema-v2.0.json",
  "title": "GEDM Dependency Constraint Object (Di) - v2.0",
  "description": "Defines a mandatory artifact required for GSEP stage execution. Enhanced for architectural clarity, integrity enforcement, and dynamic artifact management.",
  "type": "object",
  "required": [
    "artifact_id",
    "version",
    "path",
    "integrity_check",
    "context_role",
    "dependency_type"
  ],
  "properties": {
    "artifact_id": {
      "type": "string",
      "description": "Canonical identifier of the required dependency (e.g., 'Model.VetoPolicy.v3'). Should follow the naming convention [Domain].[Component].[Type].",
      "pattern": "^[A-Za-z0-9_]+\\.[A-Za-z0-9_]+\\.[A-Za-z0-9_]+$"
    },
    "version": {
      "type": "string",
      "description": "Semantic version of the required artifact (e.g., 1.0.5 or 2.0.0-beta).",
      "pattern": "^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-([0-9A-Za-z-]+(?:\\.[0-9A-Za-z-]+)*))?(?:\\+([0-9A-Za-z-]+(?:\\.[0-9A-Za-z-]+)*))?$"
    },
    "dependency_type": {
      "type": "string",
      "enum": [
        "CORE_MODEL",
        "CONFIG",
        "DATASET",
        "LOGIC_SCRIPT",
        "UTILITY",
        "METADATA",
        "K_AGENT_PATTERN"
      ],
      "description": "Classification of the artifact's nature for prioritized loading and lifecycle management. K_AGENT_PATTERN reserved for autonomous behavior blueprints."
    },
    "path": {
      "type": "string",
      "description": "CISM access path pointer (URI or internal identifier) to the artifact's location/data."
    },
    "path_type": {
      "type": "string",
      "enum": [
        "CISM_RESOLVE",
        "LOCAL_ABSOLUTE",
        "INTERNAL_REFERENCE",
        "K_CACHE_ID"
      ],
      "default": "CISM_RESOLVE",
      "description": "Specifies how the path should be interpreted by the Dependency Manager. Added K_CACHE_ID for high-speed kernel memory lookup."
    },
    "context_role": {
      "type": "string",
      "enum": [
        "PRIMARY_INPUT",
        "VALIDATION_POLICY",
        "TRANSFORMATION_AGENT",
        "ARCHITECTURAL_CONFIG",
        "FALLBACK_RESOURCE",
        "FEEDBACK_LOOP_SOURCE"
      ],
      "description": "Defines the standardized functional role this artifact plays in the execution stage."
    },
    "revalidation_frequency_ms": {
      "type": "integer",
      "minimum": 0,
      "default": 0,
      "description": "How often the dependency manager must re-validate the integrity of the artifact (in milliseconds). 0 means validation only at stage start (static). Essential for dynamic systems."
    },
    "integrity_check": {
      "type": "object",
      "description": "Details required for state artifact validation.",
      "required": [
        "method",
        "expected_hash",
        "failure_mode"
      ],
      "properties": {
        "method": {
          "type": "string",
          "enum": [
            "SHA256",
            "PGP_Signature",
            "TimeLock_Hash",
            "KERNEL_VAULT_KEY",
            "ZERO_TRUST_PROVE"
          ],
          "description": "Cryptographic integrity validation method. Added ZERO_TRUST_PROVE for enhanced, high-security protocol integration."
        },
        "expected_hash": {
          "type": "string",
          "description": "The certified, expected value for the specified integrity check (e.g., hash value or Key ID for PGP)."
        },
        "failure_mode": {
          "type": "string",
          "enum": [
            "ABORT_STAGE",
            "LOG_CRITICAL_WARN",
            "FALLBACK_GRACEFUL"
          ],
          "default": "ABORT_STAGE",
          "description": "Defines the mandated behavior upon integrity check failure, enforcing governance."
        }
      }
    },
    "optional": {
      "type": "boolean",
      "default": false,
      "description": "If true, absence of the artifact will not trigger a failure, only integrity mismatch or version incompatibility. Failure modes are now governed by integrity_check.failure_mode."
    }
  },
  "additionalProperties": false
}