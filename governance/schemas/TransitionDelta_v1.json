{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://agi.sovereign/schemas/TransitionDelta_v1.json",
  "title": "TransitionDelta_v1",
  "description": "Defines the required cryptographic state unit structure for CISM persistence and integrity verification.",
  "type": "object",
  "properties": {
    "Header": {
      "type": "object",
      "description": "Metadata and cryptographic linkage.",
      "properties": {
        "StageID": {"type": "string"},
        "TimestampUTC": {"type": "string", "format": "date-time"},
        "PrecedingHash": {"type": ["string", "null"], "description": "SHA3-512 hash of the previous certified stage, enabling chain verification."}
      },
      "required": ["StageID", "TimestampUTC", "PrecedingHash"]
    },
    "Payload": {
      "type": "object",
      "description": "The certified data committed during this stage.",
      "properties": {
        "InputVariables": {"type": "object", "description": "Key inputs consumed by the stage."},
        "StageOutputs": {"type": "object", "description": "Core results generated by the stage (e.g., model predictions)."},
        "PolicyFlags": {"type": "array", "items": {"type": "string"}, "description": "Compliance and policy adherence markers."}
      },
      "required": ["InputVariables", "StageOutputs"]
    },
    "Signature": {
      "type": "object",
      "description": "HMAC signature provided by the CRoT engine for non-repudiation.",
      "properties": {
        "HMAC_V4": {"type": "string"},
        "SigningKeyID": {"type": "string"}
      },
      "required": ["HMAC_V4", "SigningKeyID"]
    }
  },
  "required": ["Header", "Payload", "Signature"],
  "additionalProperties": false
}