{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "TEDS Log Schema (v94.1)",
  "description": "Secure and mandatory structure for Trusted Event Data Stream (TEDS) records. Enforces strict compliance across all 15 GSEP-C pipeline stages (S00-S14).",
  "type": "object",
  "required": [
    "timestamp",
    "stage",
    "agent",
    "status",
    "artifact_hash",
    "trace_id"
  ],
  "properties": {
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 UTC timestamp of event finalization."
    },
    "stage": {
      "type": "string",
      "enum": [
        "S00",
        "S01",
        "S02",
        "S03",
        "S04",
        "S05",
        "S06",
        "S07",
        "S08",
        "S09",
        "S10",
        "S11",
        "S12",
        "S13",
        "S14"
      ],
      "description": "The GSEP-C pipeline stage number."
    },
    "agent": {
      "type": "string",
      "enum": [
        "CRoT",
        "GAX",
        "SGS",
        "SYSTEM"
      ],
      "description": "The responsible governing agent (CRoT: Core Runtime, GAX: Governance/Audit, SGS: State Guardian, SYSTEM: Infrastructure/Setup)."
    },
    "status": {
      "type": "string",
      "enum": [
        "PASS",
        "FAIL",
        "COMMIT",
        "ROLLBACK",
        "INIT"
      ],
      "description": "Final result of the stage operation."
    },
    "trace_id": {
      "type": "string",
      "pattern": "^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$|^[0-9a-f]{32}$",
      "description": "Unique identifier linking all events within a single execution cycle (UUID v4 recommended)."
    },
    "message": {
      "type": "string",
      "minLength": 1,
      "description": "Human-readable detail regarding the checkpoint outcome."
    },
    "artifact_hash": {
      "type": "string",
      "pattern": "^[0-9a-fA-F]{64}$",
      "description": "Cryptographic hash (SHA-256 required) of the primary output artifact generated during this stage."
    },
    "failure_flags": {
      "type": "object",
      "description": "Specific failure states checked at this stage (required if status=FAIL).",
      "properties": {
        "PVLM": {
          "type": "boolean",
          "description": "Policy Violation Level Monitoring"
        },
        "MPAM": {
          "type": "boolean",
          "description": "Malicious Payload Assessment Metric"
        },
        "ADTM": {
          "type": "boolean",
          "description": "Asynchronous Data Integrity Mismatch"
        },
        "ECVM": {
          "type": "boolean",
          "description": "Execution Context Validation Failure"
        }
      },
      "required": [
        "PVLM",
        "MPAM",
        "ADTM",
        "ECVM"
      ],
      "additionalProperties": false
    }
  },
  "additionalProperties": false,
  "allOf": [
    {
      "if": {
        "properties": {
          "status": {
            "const": "FAIL"
          }
        },
        "required": ["status"]
      },
      "then": {
        "required": ["failure_flags"]
      },
      "else": {
        "not": {
          "required": ["failure_flags"]
        }
      }
    }
  ]
}